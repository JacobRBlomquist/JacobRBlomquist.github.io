<span class="foreground-8">  1 </span><span class="foreground-11">function</span><span class="foreground-15"> settable_event (table, key, value)                                    <span class="background-0">
</span></span><span class="foreground-8">  2 </span><span class="foreground-15">    </span><span class="foreground-12">local</span><span class="foreground-15"> h                                                         </span>           <span class="background-0"><span class="foreground-15">
</span></span><span class="foreground-8">  3 </span><span class="foreground-15">    </span><span class="foreground-12">if</span><span class="foreground-15"> </span><span class="foreground-13">type</span><span class="foreground-15">(table) == </span><span class="foreground-10">&quot;table&quot;</span><span class="foreground-15"> </span><span class="foreground-12">then</span><span class="foreground-15">                                             <span class="background-0">
</span></span><span class="foreground-8">  4 </span><span class="foreground-15">        </span><span class="foreground-12">local</span><span class="foreground-15"> v = </span><span class="foreground-13">rawget</span><span class="foreground-15">(table, key)                                           <span class="background-0">
</span></span><span class="foreground-8">  5 </span><span class="foreground-15">        </span><span class="foreground-7">-- if key is present, do raw assignment</span><span class="foreground-15">                                <span class="background-0">
</span></span><span class="foreground-8">  6 </span><span class="foreground-15">        </span><span class="foreground-12">if</span><span class="foreground-15"> v ~= </span><span class="foreground-9">nil</span><span class="foreground-15"> </span><span class="foreground-12">then</span><span class="foreground-15"> </span><span class="foreground-13">rawset</span><span class="foreground-15">(table, key, value); </span><span class="foreground-12">return</span><span class="foreground-15"> </span><span class="foreground-12">end</span><span class="foreground-15">                 <span class="background-0">
</span></span><span class="foreground-8">  7 </span><span class="foreground-15">        h = metatable(table).__newindex                                        <span class="background-0"> </span>
</span><span class="foreground-8">  8 </span><span class="foreground-15">        </span><span class="foreground-12">if</span><span class="foreground-15"> h == </span><span class="foreground-9">nil</span><span class="foreground-15"> </span><span class="foreground-12">then</span><span class="foreground-15"> </span><span class="foreground-13">rawset</span><span class="foreground-15">(table, key, value); </span><span class="foreground-12">return</span><span class="foreground-15"> </span><span class="foreground-12">end</span><span class="foreground-15">                 <span class="background-0">
</span></span><span class="foreground-8">  9 </span><span class="foreground-15">    </span><span class="foreground-12">else</span><span class="foreground-15">                                                  </span>                     <span class="background-0"><span class="foreground-15">
</span></span><span class="foreground-8"> 10 </span><span class="foreground-15">        h = metatable(table).__newindex                                        <span class="background-0"> </span>
</span><span class="foreground-8"> 11 </span><span class="foreground-15">        </span><span class="foreground-12">if</span><span class="foreground-15"> h == </span><span class="foreground-9">nil</span><span class="foreground-15"> </span><span class="foreground-12">then</span><span class="foreground-15">                                                       <span class="background-0">
</span></span><span class="foreground-8"> 12 </span><span class="foreground-15">            </span><span class="foreground-13">error</span><span class="foreground-15">(···)                                                         <span class="background-0"> </span>
</span><span class="foreground-8"> 13 </span><span class="foreground-15">        </span><span class="foreground-12">end</span><span class="foreground-15">                                                                    <span class="background-0"> </span>
</span><span class="foreground-8"> 14 </span><span class="foreground-15">    </span><span class="foreground-12">end</span><span class="foreground-15">                                                                        <span class="background-0">
</span></span><span class="foreground-8"> 15 </span><span class="foreground-15">    </span><span class="foreground-12">if</span><span class="foreground-15"> </span><span class="foreground-13">type</span><span class="foreground-15">(h) == </span><span class="foreground-10">&quot;function&quot;</span><span class="foreground-15"> </span><span class="foreground-12">then</span><span class="foreground-15">                                    </span>          <span class="background-0"><span class="foreground-15">
</span></span><span class="foreground-8"> 16 </span><span class="foreground-15">        h(table, key,value)           </span><span class="foreground-7">-- call the handler</span><span class="foreground-15">                      <span class="background-0">
</span></span><span class="foreground-8"> 17 </span><span class="foreground-15">    </span><span class="foreground-12">else</span><span class="foreground-15"> h[key] = value             </span><span class="foreground-7">-- or repeat operation on it</span>        <span class="foreground-15">       <span class="background-0">
</span></span><span class="foreground-8"> 18 </span><span class="foreground-15">    </span><span class="foreground-12">end</span><span class="foreground-15">                                                                        <span class="background-0"> </span>
</span><span class="foreground-8"> 19 </span><span class="foreground-11">end</span><span class="foreground-15">                                                                            <span class="background-0">
</span></span><span class="foreground-8">~
~
~
~
~
~
~
~
~
~
~
~
~
</span><span class="background-0"><span class="foreground-15">lua.lua                                                                               1,1            All
</span></span><span class="foreground-15">:VimFilerExplorer
